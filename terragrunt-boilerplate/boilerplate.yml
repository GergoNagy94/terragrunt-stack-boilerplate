variables:
  - name: AccountType
    description: |
      Choose your AWS account setup:

      • single              - Single AWS account for all environments
      • multi               - Separate AWS accounts per environment (development, management, monitoring, production)
    order: 0
    type: enum
    options:
      - single
      - multi
    default: single
    validate:
      - required

  - name: ProjectName
    description: "Name of your project (used in resource naming)"
    order: 1
    type: string
    default: "my-project"
    validate:
      - required
      - min-length-3
      - max-length-20

  - name: ProjectVersion
    description: "Project version"
    order: 2
    type: string
    default: "v1.0.0"

  - name: OrganizationId
    description: "AWS Organization ID (only needed for multi-account setup)"
    order: 3
    type: string
    default: "o-00000000000"

  - name: OrganizationRootId
    description: "AWS Organization Root ID (only needed for multi-account setup)"
    order: 4
    type: string
    default: "r-0000"

  - name: DevelopmentAccountId
    description: "Development Account ID"
    order: 5
    type: string
    validate:
      - required
      - length-12

  - name: ManagementAccountId
    description: "Management Account ID (multi-account setup only)"
    order: 6
    type: string
    default: "{{ .DevelopmentAccountId }}"
    validate:
      - required
      - length-12

  - name: MonitoringAccountId
    description: "Monitoring Account ID (multi-account setup only)"
    order: 7
    type: string
    default: "{{ .DevelopmentAccountId }}"
    validate:
      - required
      - length-12

  - name: ProductionAccountId
    description: "Production Account ID (multi-account setup only)"
    order: 8
    type: string
    default: "{{ .DevelopmentAccountId }}"
    validate:
      - required
      - length-12

  - name: EmailDomain
    description: "Domain for AWS account emails (e.g., example.com)"
    order: 9
    type: string
    default: "codefactory.hu"

  - name: DevelopmentRegion
    description: "Development AWS Region"
    order: 10
    type: string
    default: "eu-west-1"

  - name: ManagementRegion
    description: "Management AWS Region (multi-account setup only)"
    order: 11
    type: string
    default: "{{ .DevelopmentRegion }}"

  - name: MonitoringRegion
    description: "Monitoring AWS Region (multi-account setup only)"
    order: 12
    type: string
    default: "{{ .DevelopmentRegion }}"

  - name: ProductionRegion
    description: "Production AWS Region (multi-account setup only)"
    order: 13
    type: string
    default: "{{ .DevelopmentRegion }}"

  - name: StateRegion
    description: "Region for Terraform state bucket"
    order: 14
    type: string
    default: "eu-central-1"

  - name: InfrastructurePreset
    description: |
      Choose your AWS infrastructure setup:
      • foundation   - vpc
      • web          - s3, cloudfront, route53, webacl
      • serverless   - vpc, rds, lambda, secrets manager
      • eks-auto     - vpc, eks-automod
      • eks-managed  - vpc, eks-managed-nodegroup
    order: 15
    type: enum
    options:
      - foundation
      - web
      - serverless
      - eks-auto
      - eks-managed
    default: single
    validate:
      - required

  - name: OpentofuVersion
    description: "OpenTofu version"
    order: 16
    type: string
    default: "1.10.2"

  - name: TerragruntVersion
    description: "Terragrunt version"
    order: 17
    type: string
    default: "0.82.3"

skip_files:
  - path: "infrastructure/live/management/**/*"
    if: '{{ eq .AccountType "single" }}'

  - path: "infrastructure/live/monitoring/**/*"
    if: '{{ eq .AccountType "single" }}'

  - path: "infrastructure/live/production/**/*"
    if: '{{ eq .AccountType "single" }}'

  - path: "infrastructure/live/development/db/**/*"
    if: '{{ ne .InfrastructurePreset "serverless" }}'

  - path: "infrastructure/live/development/src/**/*"
    if: '{{ ne .InfrastructurePreset "serverless" }}'

hooks:
  before:
    - command: "echo"
      args:
        - |
          ╭─────────────────────────────────────────────────────────────╮
          │         Code Factory Terragrunt Stack Boilerplate           │
          ╰─────────────────────────────────────────────────────────────╯
          
          Starting Terragrunt Stack generation for {{.ProjectName}}...
          Account Type: {{.AccountType}}
          Infrastructure Preset: {{.InfrastructurePreset}}
          

  after:
    - command: "bash"
      args:
        - "-c"
        - "find . -type d -empty -delete 2>/dev/null || true; find . -type d -empty -delete 2>/dev/null || true; find . -type d -empty -delete 2>/dev/null || true"
      dir: "{{ outputFolder }}"

    - command: "echo"
      args:
        - |
          ╭─────────────────────────────────────────────────────────────╮
          │          Terragrunt Stack generated successfully!           │
          ╰─────────────────────────────────────────────────────────────╯
         
           mise trust && mise install
           Configure AWS credentials{{ if eq .AccountType "single" }} for development account{{ else }} for all accounts{{ end }}
           Review and customize the configuration